{{- $description := "" -}}
{{- if .Description -}}
    {{- $description = .Description -}}
{{- else if .Summary -}}
    {{- $description = .Summary | plainify | truncate 160 -}}
{{- else -}}
    {{- $description = .Site.Params.description -}}
{{- end -}}
{{- $title := "" -}}
{{- if .IsHome -}}
    {{- $title = printf "%s - Le portail du numérique responsable" .Site.Title -}}
{{- else -}}
    {{- $title = printf "%s | %s" .Title .Site.Title -}}
{{- end -}}
{{- $image := "" -}}
{{- if .Params.image -}}
    {{- $image = .Params.image | absURL -}}
{{- else -}}
    {{- $defaultImage := resources.Get "img/default.svg" -}}
    {{- if not $defaultImage -}}
        {{- $defaultImage = resources.Get "img/default.png" -}}
    {{- end -}}
    {{- if $defaultImage -}}
        {{- $image = $defaultImage.Permalink -}}
    {{- else -}}
        {{- $image = printf "%s%s" .Site.BaseURL "img/default.svg" -}}
    {{- end -}}
{{- end -}}
{{- $ogImage := $image -}}
{{- $baseURL := .Site.BaseURL -}}
{{- $permalink := .Permalink -}}

<!-- Primary Meta Tags -->
<meta name="title" content="{{ $title }}">
<meta name="description" content="{{ $description }}">
<meta name="keywords" content="{{ .Site.Params.keywords }}">
<meta name="author" content="{{ .Site.Params.author }}">
<meta name="robots" content="index, follow">
{{- if .Date -}}
<meta name="date" content="{{ .Date.Format "2006-01-02" }}">
{{- end -}}
{{- if .Lastmod -}}
<meta name="last-modified" content="{{ .Lastmod.Format "2006-01-02" }}">
{{- end -}}

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ $permalink }}">
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $description }}">
<meta property="og:image" content="{{ $ogImage }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="{{ $title }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="fr_FR">
{{- if .IsPage -}}
    {{- if .Date -}}
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    {{- end -}}
    {{- if .Lastmod -}}
<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
    {{- end -}}
    {{- if .Params.author -}}
<meta property="article:author" content="{{ .Params.author }}">
    {{- end -}}
    {{- range .Params.categories -}}
<meta property="article:tag" content="{{ . }}">
    {{- end -}}
{{- end -}}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ $permalink }}">
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $description }}">
<meta name="twitter:image" content="{{ $ogImage }}">
<meta name="twitter:image:alt" content="{{ $title }}">

<!-- Canonical URL -->
<link rel="canonical" href="{{ $permalink }}">

<!-- JSON-LD Structured Data -->
{{- if .IsHome -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{{ .Site.Title }}",
    "alternateName": "We Love Green IT",
    "description": "{{ .Site.Params.description }}",
    "url": "{{ $baseURL }}",
    "inLanguage": "fr-FR",
    "publisher": {
        "@type": "Organization",
        "@id": "{{ $baseURL }}#organization",
        "name": "{{ .Site.Title }}",
        "url": "{{ $baseURL }}",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ $baseURL }}favicon-96x96.png",
            "width": 96,
            "height": 96
        },
        "sameAs": []
    },
    "potentialAction": {
        "@type": "SearchAction",
        "target": {
            "@type": "EntryPoint",
            "urlTemplate": "{{ $baseURL }}?s={search_term_string}"
        },
        "query-input": "required name=search_term_string"
    }
}
</script>
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Organization",
    "@id": "{{ $baseURL }}#organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ $baseURL }}",
    "logo": {
        "@type": "ImageObject",
        "url": "{{ $baseURL }}favicon-96x96.png",
        "width": 96,
        "height": 96
    },
    "description": "{{ .Site.Params.description }}",
    "sameAs": []
}
</script>
{{- else if eq .Section "articles" -}}
{{- $articleImage := "" -}}
{{- if .Params.image -}}
    {{- $articleImage = .Params.image | absURL -}}
{{- else -}}
    {{- $defaultImage := resources.Get "img/default.svg" -}}
    {{- if not $defaultImage -}}
        {{- $defaultImage = resources.Get "img/default.png" -}}
    {{- end -}}
    {{- if $defaultImage -}}
        {{- $articleImage = $defaultImage.Permalink -}}
    {{- else -}}
        {{- $articleImage = printf "%s%s" .Site.BaseURL "img/default.svg" -}}
    {{- end -}}
{{- end -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "{{ .Title }}",
    "description": "{{ $description }}",
    "url": "{{ $permalink }}",
    "inLanguage": "fr-FR",
    "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- if .Lastmod -}}
    "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- end -}}
    "image": {
        "@type": "ImageObject",
        "url": "{{ $articleImage }}",
        "width": 1200,
        "height": 630
    },
    "author": {
        "@type": "{{ if .Params.author }}Person{{ else }}Organization{{ end }}",
        "name": "{{ .Params.author | default .Site.Params.author }}"
    },
    "publisher": {
        "@type": "Organization",
        "@id": "{{ $baseURL }}#organization",
        "name": "{{ .Site.Title }}",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ $baseURL }}favicon-96x96.png",
            "width": 96,
            "height": 96
        }
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ $permalink }}"
    }{{- if or .Params.categories .Params.source }},{{ end }}
    {{- if .Params.categories -}}
    "keywords": "{{ delimit .Params.categories ", " }}"
    {{- end -}}
    {{- if and .Params.categories .Params.source }},{{ end }}
    {{- if .Params.source -}}
    "sourceOrganization": {
        "@type": "Organization",
        "name": "{{ .Params.source }}"
    }
    {{- end -}}
}
</script>
{{- else if eq .Section "metiers" -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ .Title }}",
    "description": "{{ $description }}",
    "url": "{{ $permalink }}",
    "inLanguage": "fr-FR",
    {{- if .Date -}}
    "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- end -}}
    {{- if .Lastmod -}}
    "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- end -}}
    {{- if $image -}}
    "image": {
        "@type": "ImageObject",
        "url": "{{ $image }}",
        "width": 1200,
        "height": 630
    },
    {{- end -}}
    "author": {
        "@type": "Organization",
        "name": "{{ .Site.Params.author }}"
    },
    "publisher": {
        "@type": "Organization",
        "@id": "{{ $baseURL }}#organization",
        "name": "{{ .Site.Title }}",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ $baseURL }}favicon-96x96.png",
            "width": 96,
            "height": 96
        }
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ $permalink }}"
    },
    "articleSection": "Métiers du Green IT"
}
</script>
{{- else if eq .Section "guides" -}}
{{- $wordCount := .WordCount -}}
{{- $readingTime := div $wordCount 200 -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "{{ .Title }}",
    "description": "{{ $description }}",
    "url": "{{ $permalink }}",
    "inLanguage": "fr-FR",
    {{- if .Date -}}
    "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- end -}}
    {{- if .Lastmod -}}
    "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- end -}}
    {{- if $image -}}
    "image": {
        "@type": "ImageObject",
        "url": "{{ $image }}",
        "width": 1200,
        "height": 630
    },
    {{- end -}}
    "totalTime": "PT{{ $readingTime }}M",
    "estimatedCost": {
        "@type": "MonetaryAmount",
        "currency": "EUR",
        "value": "0"
    },
    "publisher": {
        "@type": "Organization",
        "@id": "{{ $baseURL }}#organization",
        "name": "{{ .Site.Title }}",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ $baseURL }}favicon-96x96.png",
            "width": 96,
            "height": 96
        }
    }
}
</script>
{{- else if eq .Section "glossaire" -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "DefinedTermSet",
    "name": "{{ .Title }}",
    "description": "{{ $description }}",
    "url": "{{ $permalink }}",
    "inLanguage": "fr-FR",
    "publisher": {
        "@type": "Organization",
        "@id": "{{ $baseURL }}#organization",
        "name": "{{ .Site.Title }}"
    }
}
</script>
{{- else if eq .Section "ressources" -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ .Title }}",
    "description": "{{ $description }}",
    "url": "{{ $permalink }}",
    "inLanguage": "fr-FR",
    {{- if .Date -}}
    "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    {{- end -}}
    {{- if $image -}}
    "image": {
        "@type": "ImageObject",
        "url": "{{ $image }}",
        "width": 1200,
        "height": 630
    },
    {{- end -}}
    "publisher": {
        "@type": "Organization",
        "@id": "{{ $baseURL }}#organization",
        "name": "{{ .Site.Title }}"
    },
    "articleSection": "Ressources Green IT"
}
</script>
{{- end -}}

<!-- BreadcrumbList pour toutes les pages sauf la home -->
{{- if not .IsHome -}}
{{- $breadcrumbs := slice -}}
{{- $homeURL := $baseURL -}}
{{- if not (hasPrefix $homeURL "http") -}}
    {{- $homeURL = printf "%s%s" $baseURL "/" -}}
{{- end -}}
{{- $breadcrumbs = $breadcrumbs | append (dict "name" "Accueil" "url" $homeURL) -}}
{{- if .Section -}}
    {{- $sectionPage := .Site.GetPage (printf "/%s" .Section) -}}
    {{- if $sectionPage -}}
        {{- $breadcrumbs = $breadcrumbs | append (dict "name" $sectionPage.Title "url" $sectionPage.Permalink) -}}
    {{- end -}}
{{- end -}}
{{- $breadcrumbs = $breadcrumbs | append (dict "name" .Title "url" $permalink) -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {{- range $index, $crumb := $breadcrumbs -}}
        {
            "@type": "ListItem",
            "position": {{ add $index 1 }},
            "name": "{{ $crumb.name }}",
            "item": "{{ $crumb.url }}"
        }{{ if lt $index (sub (len $breadcrumbs) 1) }},{{ end }}
        {{- end -}}
    ]
}
</script>
{{- end -}}

<!-- ItemList pour les pages de liste -->
{{- if and (not .IsHome) (eq .Kind "section") -}}
{{- $items := first 10 .Pages -}}
{{- if gt (len $items) 0 -}}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "{{ .Title }}",
    "description": "{{ $description }}",
    "url": "{{ $permalink }}",
    "inLanguage": "fr-FR",
    "mainEntity": {
        "@type": "ItemList",
        "numberOfItems": {{ len .Pages }},
        "itemListElement": [
            {{- range $index, $item := $items -}}
            {
                "@type": "ListItem",
                "position": {{ add $index 1 }},
                "item": {
                    "@type": "{{ if eq $item.Section "articles" }}NewsArticle{{ else if eq $item.Section "guides" }}HowTo{{ else }}Article{{ end }}",
                    "name": "{{ $item.Title }}",
                    "url": "{{ $item.Permalink }}"
                }
            }{{ if lt $index (sub (len $items) 1) }},{{ end }}
            {{- end -}}
        ]
    }
}
</script>
{{- end -}}
{{- end -}}
